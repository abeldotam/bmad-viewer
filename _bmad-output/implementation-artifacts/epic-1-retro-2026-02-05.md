# Epic 1 Retrospective: Authentification & accès projet

Date: 2026-02-05

## Epic Summary

- **Stories delivered:** 4/4 (100%)
- **Stories:** 1.1 Fondations, 1.2 Auth/session, 1.3 Dashboard/repos, 1.4 Proxy GitHub/préchargement
- **FRs couverts:** FR1–FR10, FR32

## What Went Well

- **SSR disabled early (ADR):** La décision de couper SSR (`ssr: false`) dès le départ a évité des heures de debug avec reka-ui. Décision architecturale payante.
- **Auth localStorage + Authorization header:** L'approche sans cookies SSR simplifie le modèle de sécurité tout en garantissant la persistance de session (FR4).
- **Chiffrement AES-256-GCM côté serveur:** `@noble/ciphers` fonctionne bien, les tokens ne sont jamais exposés côté client (NFR7).
- **Préchargement via provide/inject:** Le pattern `useRepoData` avec provide au niveau du layout repo évite les props drilling et les appels API redondants. Navigation entre onglets instantanée (NFR2).
- **Validation token à l'ajout:** Le serveur vérifie le token GitHub + existence du repo avant persistance — pas de données invalides en base.

## What Could Be Improved

- **Pas de "sync now":** Les données sont cachées en base (`cached_files`) sans TTL ni bouton de refresh manuel. Si un fichier change sur GitHub, l'utilisateur ne le voit pas immédiatement.
- **Pas de gestion d'expiration token:** Si un token GitHub est révoqué après l'ajout du repo, l'erreur n'est visible qu'au prochain fetch (pas de health check proactif).
- **Table `cached_files` sans TTL:** Le cache n'expire jamais — potentiel de données stale sur les repos très actifs.

## Key Insights

- Le pattern `useState` + `provide/inject` s'est avéré suffisant pour l'état applicatif — Pinia n'était pas nécessaire pour un viewer read-only.
- La séparation stricte client/serveur pour les tokens GitHub (tout passe par `/api/github/*`) est un bon pattern de sécurité par défaut.

## Action Items

1. **Ajouter un TTL au cache** — enrichir `cached_files` avec une colonne `expires_at` et invalider au fetch
2. **Bouton "sync now"** — permettre un refresh manuel des données depuis l'UI
3. **Health check token** — vérifier la validité du token à l'ouverture d'un repo (appel léger à l'API GitHub)

## Readiness Assessment

- [x] Tous les AC satisfaits
- [x] Auth email + GitHub OAuth fonctionnels
- [x] RLS Supabase en place
- [x] Tokens chiffrés, jamais côté client
- [x] Préchargement parallèle < 3s
