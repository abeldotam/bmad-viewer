# Rétrospective Epic 7 : Transition open-source & self-host

Date : 2026-02-20

## Résumé de l'Epic

- **Stories livrées :** 6/6 (100%)
- **Stories :**
  - 7.1 Détection dual-mode & configuration runtime
  - 7.2 Remplacement auth Supabase par nuxt-auth-utils
  - 7.3 Remplacement PostgreSQL Supabase par SQLite + Drizzle
  - 7.4 Adapter les routes GitHub API au dual-mode
  - 7.5 Nettoyage code Supabase & migration
  - 7.6 Documentation, packaging Docker & open-source
- **FRs impactés :** FR1 (supprimé), FR2/FR7/FR10 (modifiés), FR-OS1 à FR-OS7 (nouveaux)
- **Bloqueurs :** 0
- **Incidents production :** 0

## Participants

- Bob (Scrum Master) — Facilitation
- Alice (Product Owner) — Perspective produit
- Charlie (Senior Dev / Architect) — Perspective technique
- Dana (QA Engineer) — Perspective qualité
- Elena (Junior Dev) — Perspective développement
- Abel (Project Lead)

## Ce qui a bien marché

### Simplification systématique

Chaque story a réduit la complexité du code au lieu de l'augmenter :
- Encryption AES-256-GCM supprimée (token en session cookie uniquement)
- Service client Supabase supprimé
- `useApi.ts` simplifié (plus de Bearer token, cookie auto-envoyé)
- `AddRepoModal.vue` réduit de 3 champs à 2 (plus de token GitHub à saisir)
- Pattern centralisé `getGitHubToken(event)` au lieu du flow decrypt complexe

### Exécution fluide avec parallélisme

- Chaîne de dépendances bien pensée : 7.1 → 7.2/7.3 (parallèle) → 7.4 → 7.5 → 7.6
- Stories 7.2 (auth) et 7.3 (database) développées en parallèle sans conflit
- 0 bloqueur, 0 rework

### Indépendance acquise

- Application 100% indépendante de Supabase
- Self-hostable via Docker en < 5 minutes
- Dual-mode (Personal / Multi-user / Unconfigured) fonctionnel
- Licence MIT, documentation complète

### Sécurité préservée

- Token GitHub toujours serveur-only (session cookie ou env var)
- Pas de régression de sécurité malgré le changement d'architecture

### Documentation intégrée

- Dev Notes détaillées dans chaque story avec décisions et fichiers modifiés
- Essentiel pour la chaîne de dépendances entre stories

## Ce qui pourrait être amélioré

### Piège pnpm v10

pnpm v10 bloque les build scripts natifs par défaut. `better-sqlite3` nécessite `pnpm.onlyBuiltDependencies` dans `package.json`. Découvert en Story 7.3, chronophage à diagnostiquer.

### Action items Epic 6 non adressés

3 action items de la rétrospective Epic 6 n'ont pas été traités :
1. Preview Markdown dans CommentForm et NewStoryModal
2. Debounce soumission pour éviter les doublons d'issues
3. Setup labels BMAD avec couleurs sur un repo

**Justification :** L'Epic 7 était une refonte architecturale complète — les améliorations UX étaient hors scope. Mais il faut un mécanisme pour ne pas perdre les action items entre les retros.

### Stubs existants

- `RelatedPRs.vue` reste un stub (texte statique seulement)
- `SprintCard.vue` n'affiche pas de texte explicite quand un epic a 0 stories

### Absence de tests automatisés

Pas de tests formels (Vitest) — seul le CI (lint + typecheck) est en place. Risque principal pour un projet open-source acceptant des contributions.

## Enseignements clés

1. **La migration par simplification est supérieure** — Chaque story a réduit la complexité. Le code post-Epic 7 est plus propre, plus sûr, et plus facile à maintenir.
2. **Le parallélisme bien planifié accélère la livraison** — Les stories 7.2/7.3 en parallèle ont fonctionné grâce à l'absence de dépendance directe entre elles.
3. **Les Dev Notes détaillées sont un multiplicateur de vélocité** — Pour les chaînes de dépendances, la documentation intégrée dans les stories est essentielle.
4. **Les tests automatisés sont le prochain investissement critique** — L'absence de tests est le gap le plus important pour un projet open-source.

## Suivi de la rétrospective Epic 6

| Action Item | Statut | Commentaire |
|---|---|---|
| Preview Markdown dans CommentForm/NewStoryModal | ❌ Non adressé | Hors scope Epic 7 (refonte archi) |
| Debounce soumission | ❌ Non adressé | Hors scope Epic 7 |
| Setup labels BMAD avec couleurs | ❌ Non adressé | Hors scope Epic 7 |

**Leçon :** Intégrer systématiquement les action items des retros dans le planning des cycles suivants (checklist d'entrée).

## Action Items

### Améliorations de process

1. **Checklist retro → planning** — Intégrer systématiquement les action items des rétrospectives précédentes dans le planning des epics/cycles suivants
   - Owner : Bob (Scrum Master)
   - Critère de succès : un check "retro items" existe dans le workflow de planning

2. **Documenter le piège pnpm v10** — Ajouter une note dans CLAUDE.md sur `pnpm.onlyBuiltDependencies` pour les modules natifs
   - Owner : Charlie (Senior Dev)
   - Critère de succès : note ajoutée dans la section Tech Stack

### Reportés de la rétrospective Epic 6

3. **Preview Markdown** — Ajouter un toggle preview dans `CommentForm.vue` et `NewStoryModal.vue`
   - Owner : Elena (Junior Dev)
   - Priorité : faible

4. **Debounce soumission** — Désactiver le bouton submit pendant 2s après clic pour éviter les doublons d'issues
   - Owner : Elena (Junior Dev)
   - Priorité : moyenne

5. **Setup labels BMAD** — Créer un endpoint ou script pour initialiser les labels BMAD avec couleurs sur un repo
   - Owner : Charlie (Senior Dev)
   - Priorité : faible

### Dette technique

6. **Implémenter RelatedPRs.vue** — Remplacer le stub par un composant fonctionnel (mapping PRs → stories)
   - Owner : Charlie (Senior Dev)
   - Priorité : moyenne

7. **SprintCard texte "no stories"** — Ajouter un message explicite quand un epic a 0 stories
   - Owner : Elena (Junior Dev)
   - Priorité : faible

### Priorité prochain cycle

8. **Tests automatisés (Vitest)** — Ajouter des tests pour les composants critiques du dual-mode : `getAppMode`, `getGitHubToken`, `useDatabase`, API routes GitHub, et un test E2E basique pour les deux modes
   - Owner : Dana (QA Engineer) + Charlie (Senior Dev)
   - Priorité : haute
   - Setup recommandé : Vitest + @vue/test-utils

## Évaluation de préparation

| Critère | Statut |
|---------|--------|
| Testing & Qualité | ⚠️ CI OK (lint+typecheck), pas de tests automatisés — priorité prochain cycle |
| Déploiement | ✅ Déployé et fonctionnel |
| Acceptation stakeholders | ✅ Projet solo, Abel valide |
| Santé technique | ✅ Code simplifié par la migration |
| Bloqueurs non résolus | ✅ Aucun |
| Stubs existants | ⚠️ RelatedPRs.vue (stub), SprintCard.vue (no stories text) |

## Prochaines étapes

1. Ajouter des tests automatisés (Vitest) pour les composants critiques du dual-mode
2. Traiter les 8 action items identifiés
3. Planifier le prochain cycle de développement (Epic 8 ou améliorations)
